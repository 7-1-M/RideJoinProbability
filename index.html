<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>TG Ride Probability Calculator</title>
    <style>
        :root {
            --bg: #ffffff;
            --text: #111111;
            --fieldset: #f5f5f5;
            --border: #cccccc;
            --input-bg: #ffffff;
            --result: #000000;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f1115;
                --text: #e6e6e6;
                --fieldset: #1a1d24;
                --border: #333845;
                --input-bg: #151821;
                --result: #ffffff;
            }
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: auto;
            background: var(--bg);
            color: var(--text);
        }

        fieldset {
            margin-bottom: 15px;
            background: var(--fieldset);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        label {
            display: block;
            margin-top: 8px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 6px;
            background: var(--input-bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #4ea1ff;
        }

        .result {
            font-size: 28px;
            font-weight: bold;
            margin-top: 20px;
            text-align: center;
            color: var(--result);
        }

        .emoji {
            font-size: 48px;
            margin-top: 10px;
            text-align: center;
        }

        .small {
            font-size: 12px;
            color: #888;
        }

        .header {
            margin: 20px 0;
            padding: 24px;
            border-radius: 14px;
            text-align: center;
            background: linear-gradient(135deg, #888, #555);
            color: white;
            transition: background 0.6s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        }

        .header-title {
            font-size: 16px;
            opacity: 0.85;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .header-value {
            font-size: 42px;
            font-weight: bold;
            margin-top: 8px;
        }

        .header-emoji {
            font-size: 52px;
            margin-top: 6px;
        }

        @media (prefers-color-scheme: dark) {
            .header {
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            }
        }

        #reasons {
            display: none;
            margin-top: 20px;
            border-radius: 12px;
            background: var(--fieldset);
            border: 1px solid var(--border);
            padding: 16px 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        #reasons legend {
            font-weight: bold;
            font-size: 16px;
            padding: 0 10px;
        }

        #reasonList {
            list-style: none;
            /* remove default bullets */
            margin: 10px 0 0 0;
            padding: 0;
        }

        #reasonList li {
            margin: 8px 0;
            padding-left: 24px;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
        }

        #reasonList li::before {
            content: "‚ö†Ô∏è";
            /* or any emoji you like */
            position: absolute;
            left: 0;
            top: 0;
            font-size: 16px;
            line-height: 1.4;
        }
    </style>

</head>

<body>

    <div id="header" class="header">
        <div class="header-content">
            <div class="header-title">Join Probability</div>
            <div class="header-value" id="result">‚Äî</div>
            <div class="header-emoji" id="emoji">ü§î</div>
        </div>

        <div id="reasons" style="display:none;">
            <fieldset>
                <legend>Why TG Might Skip This Ride</legend>
                <ul id="reasonList"></ul>
            </fieldset>
        </div>

    </div>

    <form id="rideForm">

        <fieldset>
            <legend>Date & Time</legend>
            <label>Date
                <input type="date" id="date">
            </label>

            <label>Start Time
                <input type="time" id="startTime" value="11:30">
            </label>

            <label>End Time
                <input type="time" id="endTime" value="15:30">
            </label>
        </fieldset>

        <fieldset>
            <legend>Weather</legend>
            <label>Chance of Rain (%)
                <input type="number" id="rain" min="0" max="100" value="10">
            </label>

            <label>Chance of Fog (%)
                <input type="number" id="fog" min="0" max="100" value="10">
            </label>

            <label>Lowest Temperature on Ride (¬∞C)
                <input type="number" id="temp" value="0">
            </label>

            <label>Wind Speed (km/h)
                <input type="number" id="wind" value="0">
            </label>
        </fieldset>

        <fieldset>
            <legend>Route</legend>
            <label>Max Gradient (%)
                <input type="number" id="gradient" value="10">
            </label>
        </fieldset>

        <fieldset>
            <legend>Group Composition</legend>
            <label>Riders (one per line: Name Surname FTP)
                <textarea id="riders" rows="4">Alex Rider 280</textarea>
            </label>
        </fieldset>

        <fieldset>
            <legend>TG Training Volume</legend>
            <select id="training">
                <option value="1.1">Low</option>
                <option value="1.0" selected>Normal</option>
                <option value="0.9">High</option>
                <option value="0.9">Very High</option>
            </select>
        </fieldset>

    </form>

    <script>
        function clamp(v, min, max) {
            return Math.max(min, Math.min(max, v));
        }

        function calculate() {
            let reasons = [];
            let p = 1.0;

            // Date logic
            const dateVal = document.getElementById("date").value;
            if (dateVal) {
                const day = new Date(dateVal).getDay();
                if (day >= 1 && day <= 5) {
                    p *= 0.5;
                    reasons.push("Weekday ride");
                }
            }


            // Time & length
            const start = document.getElementById("startTime").value;
            const end = document.getElementById("endTime").value;
            if (start && end) {
                const s = new Date(`1970-01-01T${start}`);
                const e = new Date(`1970-01-01T${end}`);
                const hours = (e - s) / 36e5;


                if (hours < 2 || hours > 5) {
                    p *= 0.7;
                    reasons.push("Ride duration outside ideal 2‚Äì5 hours");
                }

                const sh = s.getHours() + s.getMinutes() / 60;
                if (sh < 11 || sh > 13) {
                    p *= 0.8;
                    reasons.push("Start time not in optimal window (11:00‚Äì13:00)");
                }
            }

            // Weather
            const rain = document.getElementById("rain").value / 100;
            const fog = document.getElementById("fog").value / 100;
            if (rain > 0.2) reasons.push(`Rain chance ${Math.round(rain * 100)}%`);
            if (fog > 0.3) reasons.push(`Fog chance ${Math.round(fog * 100)}%`);
            p *= (1 - rain * 0.7);
            p *= (1 - fog * 0.7);


            // Temperature
            const temp = document.getElementById("temp").value;
            if (temp < 0) reasons.push("Below freezing temperatures expected");
            else if (temp > 40) reasons.push("Extremely high temperatures expected");

            if (temp < 10 || temp > 30) p *= 0.8;
            if (temp < 0 || temp > 40) p *= 0.5;

            // Wind
            const wind = document.getElementById("wind").value;
            if (wind > 15) p *= 0.85;
            else if (wind > 30) p *= 0.6;
            if (wind > 15) reasons.push("Windy conditions");
            else if (wind > 30) reasons.push("Very strong wind");


            // Gradient hard cutoff
            const gradient = document.getElementById("gradient").value;
            if (gradient > 15) {
                p = 0;
                reasons.push("Max gradient over 15% (absolute deal breaker)");
            }

            // Riders
            const ridersText = document.getElementById("riders").value.toLowerCase();
            const riders = ridersText.split("\n").filter(r => r.trim());
            const size = riders.length;

            if (size > 8) p *= 0.9;
            if (ridersText.includes("noah")) {
                p *= 0.5;
                reasons.push("Chance of Noah participating.");
            }
            if (ridersText.includes("emanuel"))  {
                if (riders == 1) p = 1;
                else p *= 1.1;
            }

            if (size > 8) reasons.push("Group too large");

            // Training volume
            p *= parseFloat(document.getElementById("training").value);

            p = clamp(p, 0, 1);

            const percent = (p * 100).toFixed(1);
            document.getElementById("result").innerText = `${percent}%`;

            let emoji = "ü§î";
            let background = "linear-gradient(135deg, #777, #555)";

            if (p === 0) {
                emoji = "‚ò†Ô∏è";
                background = "linear-gradient(135deg, #000000, #434343)";
            } else if (p < 0.15) {
                emoji = "ü§Æ";
                background = "linear-gradient(135deg, #8b0000, #ff2e2e)";
            } else if (p < 0.3) {
                emoji = "üí©";
                background = "linear-gradient(135deg, #7a3e00, #c56b00)";
            } else if (p < 0.5) {
                emoji = "üò¨";
                background = "linear-gradient(135deg, #ff8c00, #ffc04d)";
            } else if (p < 0.7) {
                emoji = "üôÇ";
                background = "linear-gradient(135deg, #3a9bdc, #67c7ff)";
            } else if (p < 0.85) {
                emoji = "üòé";
                background = "linear-gradient(135deg, #2ecc71, #27ae60)";
            } else {
                emoji = "üî•";
                background = "linear-gradient(135deg, #00c853, #b2ff59)";
            }

            document.getElementById("emoji").innerText = emoji;
            document.getElementById("header").style.background = background;

            const reasonBox = document.getElementById("reasons");
            const list = document.getElementById("reasonList");
            list.innerHTML = "";

            if (p < 0.7 && reasons.length > 0) {
                reasons.forEach(r => {
                    const li = document.createElement("li");
                    li.textContent = r;
                    list.appendChild(li);
                });
                reasonBox.style.display = "block";
            } else {
                reasonBox.style.display = "none";
            }

        }

        // Live calculation
        document.querySelectorAll("input, select, textarea")
            .forEach(el => el.addEventListener("input", calculate));

          // Set initial date to today
        const dateInput = document.getElementById("date");
        const today = new Date().toISOString().split("T")[0];
        dateInput.value = today;
        
        // Initial run
        calculate();
    </script>

</body>

</html>
